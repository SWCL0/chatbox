<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>Socket.IO chat</title>
    <link rel="stylesheet" href="style.css" type="text/css">
  </head>
  <body>
    <div id="navbarForm">
      <form id="formNavbar" action="">
        <input id="inputNavbar" autocomplete="off" placeholder="Firstname Lastname" /><button>Enter</button>
      </form>
      <div id="navbarChatName">
        <p>Chat Name: <span class="chatName"></span></p>
      </div>
    </div>
    <div class="textArea">
      <ul id="messages"></ul>      
    </div>

    <form id="formMessage" action="">
      <input id="inputMessage" autocomplete="off" placeholder="Message..." /><button>Send</button>
    </form>
    <script src="/socket.io/socket.io.js"></script>
    <script>
          document.addEventListener("DOMContentLoaded", function() {
            const socket = io();

            const form = document.getElementById('formMessage');
            const inputMessage = document.getElementById('inputMessage');
            const messages = document.getElementById('messages');

            const formNavbar = document.getElementById('formNavbar');
            const inputNavbar = document.getElementById('inputNavbar');
            
            // wanneer de submit knop van de chatname form word ingedrukt
            formNavbar.addEventListener('submit', (e) => {
              e.preventDefault();
              // check of inputNavbar.value een waarde heeft, als wel
              if (inputNavbar.value) {
                const name = inputNavbar.value;
                // emit de naam naar de server
                socket.emit('name', name);
                // weer leeg maken
                inputNavbar.value = '';
              }
            });

            // wanneer de reactie met 'name' van de server terug komt
            socket.on('name', (usr) => {
              // krijg de div en veranderd de textContent ervan
              const name = document.getElementsByClassName('chatName')[0];
              name.textContent = usr;
            });


            // wanneer de submit knop van de berichten box word ingedrukt
            formMessage.addEventListener('submit', (e) => {
                e.preventDefault();
                // checkt of inputMessage.value een waarde heeft, als wel
                if (inputMessage.value) {
                  // maak variable aan
                  const date = new Date();
                  // maak het locale tijd in text
                  const local = date.toLocaleTimeString();
                  // voeg de waardes toe aan een const
                  const message = { text: inputMessage.value, time: local };
                  // roep functie addMessage op om verder af te handelen
                  addMessage(message, 'user-temp');
                  // emit de chat message naar de server
                  socket.emit('chat message', message);
                  // maak het weer leeg
                  inputMessage.value = '';
                }
            });
            socket.on('chat message', (msg) => {
              addMessage(msg, 'other');
            });
          

            function addMessage(message, type) {
              const messageContainer = document.createElement('li');
              messageContainer.classList.add('message-container', type);

              const messageElement = document.createElement('div');
              messageElement.classList.add('message', type);
              messageElement.textContent = `${message.text}`;

              const messageTime = document.createElement('div');
              messageTime.classList.add('time');
              messageTime.textContent = `${message.time}`;

              messageContainer.appendChild(messageElement);
              messageContainer.appendChild(messageTime);
              messages.appendChild(messageContainer);

              if (type === 'user-temp') {
                setTimeout(() => {
                  messages.removeChild(messageContainer);
                }, 1);
              }

              window.scrollTo(0, document.body.scrollHeight);
            }
          });
    </script>
  </body>
</html>