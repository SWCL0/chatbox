<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>Socket.IO chat</title>
    <link rel="stylesheet" href="style.css" type="text/css">
  </head>
  <body>
    <div class="textArea">
      <ul id="messages"></ul>      
    </div>

    <form id="form" action="">
      <input id="input" autocomplete="off" placeholder="Message..." /><button>Send</button>
    </form>
    <script src="/socket.io/socket.io.js"></script>
    <script>
          document.addEventListener("DOMContentLoaded", function() {
            const socket = io();

            const form = document.getElementById('form');
            const input = document.getElementById('input');
            const messages = document.getElementById('messages');

            form.addEventListener('submit', (e) => {
                e.preventDefault();
                if (input.value) {
                  const date = new Date();
                  const local = date.toLocaleTimeString();
                  const message = { text: input.value, time: local };
                  console.log('Sending message:', message);
                  socket.emit('chat message', message);
                  addMessage(message, 'user-temp');
                  input.value = '';
                }
            });

            socket.on('chat message', (msg => {
              addMessage(msg, 'other');
            }));

            function addMessage(message, type) {
              const messageContainer = document.createElement('li');
              messageContainer.classList.add('message-container', type);

              const messageElement = document.createElement('div');
              messageElement.classList.add('message', type);
              messageElement.textContent = `${message.text}`;

              const messageTime = document.createElement('div');
              messageTime.classList.add('time');
              messageTime.textContent = `${message.time}`;
              console.log('received final time:', messageTime)

              messageContainer.appendChild(messageElement);
              messageContainer.appendChild(messageTime);
              console.log(messageContainer);
              messages.appendChild(messageContainer);
              console.log(messages);


              if (type === 'user-temp') {
                setTimeout(() => {
                  messages.removeChild(messageContainer);
                }, 1);
              }

              window.scrollTo(0, document.body.scrollHeight);
            };
          });
    </script>
  </body>
</html>